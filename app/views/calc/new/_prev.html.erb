<table class="table-bordered weather">
  <caption><%= caption %></caption>
  <thead>
  	<tr bgcolor="gray">
  	  <th width="50">Time</th>
  	  <th width="80">Temperature</th>
      <th width="50">Dew</th>
      <th width="60">Humidity</th>
      <th width="60">Pressure</th>
  	  <th width="60">Wind</th>
      <th width="10" class="blue"></th>
      <th width="50">Home Team Total 1</th>
      <th width="50">Home Team Total 2</th>
      <th width="50">Total Hits not in Park Average</th>
      <th width="50">Total HR's not in this park</th>
      <th width="50">Home Total Count</th>
      <th width="10" class="blue"></th>
      <th width="50">Home +/- 1</th>
      <th width="50">Home Total Count +/- 1</th>
      <th width="50">Total Lines Average</th>
      <th width="10" class="blue"></th>
      <th width="50">Home Team Total 1</th>
      <th width="50">Home Team Total 2</th>
      <th width="50">Total Hits in Park Average</th>
      <th width="50">Total HR's in this park</th>
      <th width="50">Home Total Count</th>
      <th width="10" class="blue"></th>
      <th width="50">Home +/- 1</th>
      <th width="50">Home Total Count +/- 1</th>
      <th width="50">Total Lines Average</th>
      <th width="50" style="background: red;">Time</th>
      <th width="50" style="background: red;">Home Team Total 1</th>
      <th width="50" style="background: red;">Home Team Total 2</th>
      <th width="50" style="background: red;">Total Hits in Park Average</th>
      <th width="50" style="background: red;">Total HR's in this park</th>
      <th width="50" style="background: red;">Home Total Count</th>
      <th width="10" style="background: red;"></th>
      <th width="50" style="background: red;">Home +/- 1</th>
      <th width="50" style="background: red;">Home Total Count +/- 1</th>
      <th width="50" style="background: red;">Total Lines Average</th>
  	</tr>
  </thead>
  <tbody>
    <% if weathers[3]['temp_num'] != 0.0 %>
      <% result = prev_data(name) %>
      <tr bgcolor="#DC143C">
        <td></td>
        <td colspan="5"><%= caption %></td>
        <td class="blue"></td>
        <td style="background: yellow;"><%= result[:home_total_runs1_avg_dup] %></td>
        <td style="background: yellow;"><%= result[:home_total_runs2_avg_dup] %></td>
        <td colspan="5" style="background: yellow;">All Stadiums except <%= stadium %></td>
        <td style="background: yellow;"><%= result[:total_hits_park_avg_dup] %></td>
        <td style="background: yellow;"><%= result[:total_hr_park_dup] %></td>
        <td class="blue"></td>
        <td style="background: sandybrown;"><%= result[:home_total_runs1_avg] %></td>
        <td style="background: sandybrown;"><%= result[:home_total_runs2_avg] %></td>
        <td colspan="5" style="background: sandybrown;">Only <%= stadium %></td>
        <td style="background: sandybrown;"><%= result[:total_hits_park_avg] %></td>
        <td style="background: sandybrown;"><%= result[:total_hr_park] %></td>
        <td></td>
        <td><%= result[:home_total_runs1_avg] %></td>
        <td><%= result[:home_total_runs2_avg] %></td>
        <td colspan="5" >Only <%= stadium %> with wind</td>
        <td><%= result[:total_hits_park_avg] %></td>
        <td><%= result[:total_hr_park] %></td>
      </tr>

      <% weathers.each_with_index do |weather, index|
        wind_min = weather['wind_speed'].to_f - 5
        wind_max = weather['wind_speed'].to_f + 5
        wind_min = 3 if wind_min < 3
        %>
        <% result = true_data_prev((weather['temp_num'] - 5).round(1), (weather['temp_num'] + 5).round(1), (weather['dew_num']-2).round(1), (weather['dew_num']+2).round(1), (weather['humid_num']-3).round, (weather['humid_num']+3).round, (weather['pressure_num']-0.04).round(2), (weather['pressure_num']+0.04).round(2), wind_min, wind_max, weather['wind_dir'], weather['wind_dir'], name) %>
      	<tr>
      		<td class="lightgray"><%= "#{index + 1} hour" %></td>
          <td><%= weather['temp'] %></td>
          <td><%= weather['dp'] %></td>
          <td><%= weather['hum'] %></td>
          <td><%= weather['pressure'] %></td>
          <td><%= weather['wind_speed'].to_s + ' ' + weather['wind_dir'] %></td>
          <td class="blue"></td>
          <td><%= result[:home_total_runs1_avg_dup] %></td>
          <td><%= result[:home_total_runs2_avg_dup] %></td>
          <td><%= result[:total_hits_park_avg_dup] %></td>
          <td><%= result[:total_hr_park_dup] %></td>
          <td><%= result[:home_count_dup] %></td>
          <td class="blue"></td>
          <td><%= result[:home_one_dup] %></td>
          <td><%= result[:home_one_count_dup] %></td>
          <td style="background: gray; color: sandybrown;"><%= result[:total_lines_park_avg_dup] %></td>
          <td class="blue"></td>
          <td style="background: sandybrown;"><%= result[:home_total_runs1_avg] %></td>
          <td style="background: sandybrown;"><%= result[:home_total_runs2_avg] %></td>
          <td style="background: sandybrown;"><%= result[:total_hits_park_avg] %></td>
          <td style="background: sandybrown;"><%= result[:total_hr_park] %></td>
          <td style="background: sandybrown;"><%= result[:home_count] %></td>
          <td class="blue"></td>
          <td style="background: sandybrown;"><%= result[:home_one] %></td>
          <td style="background: sandybrown;"><%= result[:home_one_count] %></td>
          <td style="background: gray; color: sandybrown;"><%= result[:total_lines_park_avg] %></td>
          <td class="lightgray"><%= "#{index + 1} hour" %></td>
          <td bgcolor="lightgray"><%= result[:home_total_runs1_avg_wind] %></td>
          <td bgcolor="lightgray"><%= result[:home_total_runs2_avg_wind] %></td>
          <td bgcolor="lightgray"><%= result[:total_hits_park_avg_wind] %></td>
          <td bgcolor="lightgray"><%= result[:total_hr_park_wind] %></td>
          <td bgcolor="lightgray"><%= result[:home_count_wind] %></td>
          <td class="blue"></td>
          <td bgcolor="lightgray"><%= result[:home_one_wind] %></td>
          <td bgcolor="lightgray"><%= result[:home_one_count_wind] %></td>
          <td style="background: gray; color: sandybrown;"><%= result[:total_lines_park_avg_wind] %></td>
      	</tr>
      <% end %>

      <%= render partial: "game/new/weather_blank", locals: { color: "#DC143C" } %>

      <% weathers.each_with_index do |weather, index| %>
        <%= render partial: "game/new/prev_weather_value", locals: { caption: "#{index + 1} hour", temp_min: (weather['temp_num'] - 4).round(1), temp_max: (weather['temp_num'] + 4).round(1), dew_min: (weather['dew_num']-2).round(1), dew_max: (weather['dew_num']+2).round(1), hum_min: (weather['humid_num']-3).round, hum_max: (weather['humid_num']+3).round, pressure_min: (weather['pressure_num']-0.04).round(2), pressure_max: (weather['pressure_num']+0.04).round(2), name: name, wind: weather['wind_speed'].to_s + ' ' + weather['wind_dir'], color: "", weather_one_speed: weather['wind_speed'], weather_two_speed: weather['wind_speed'], weather_one_dir: weather['wind_dir'], weather_two_dir: weather['wind_dir'] } %>
      <% end %>

      <%= render partial: "game/new/weather_blank", locals: { color: "#DC143C" } %>
      <% (1..3).each do |one_sec| %>
        <%
          weather_one = weathers[one_sec - 1]
          weather_two = weathers[one_sec]

          temp_min = weather_one['temp_num']
          temp_max = weather_two['temp_num']
          if temp_min > temp_max
            temp_min = weather_two['temp_num']
            temp_max = weather_one['temp_num']
          end
          temp_diff = ((16 + temp_min - temp_max)/2).to_i
          temp_min = (temp_min - temp_diff).round(1)
          temp_max = (temp_max + temp_diff).round(1)

          dew_min = weather_one['dew_num']
          dew_max = weather_two['dew_num']
          if dew_min > dew_max
            dew_min = weather_two['dew_num']
            dew_max = weather_one['dew_num']
          end
          dew_diff = ((7 + dew_min - dew_max)/2).to_i
          dew_min = (dew_min - dew_diff).round(1)
          dew_max = (dew_max + dew_diff).round(1)

          hum_min = weather_one['humid_num']
          hum_max = weather_two['humid_num']
          if hum_min > hum_max
            hum_min = weather_two['humid_num']
            hum_max = weather_one['humid_num']
          end
          if (hum_max - hum_min) < 9
            hum_diff = ((8 + hum_min - hum_max)/2).to_i
            hum_min = (hum_min - hum_diff).round
            hum_max = (hum_max + hum_diff).round
          end

          pressure_min = (weather_one['pressure_num'] * 100).round
          pressure_max = (weather_two['pressure_num'] * 100).round
          if pressure_min > pressure_max
            pressure_min = (weather_two['pressure_num'] * 100).round
            pressure_max = (weather_one['pressure_num'] * 100).round
          end
          pressure_diff = ((8 + pressure_min - pressure_max)/2).to_i
          pressure_min = ((pressure_min - pressure_diff)/100.0).round(2)
          pressure_max = ((pressure_max + pressure_diff)/100.0).round(2)
        %>
          <%= render partial: "game/new/prev_weather_value", locals: { caption: "With wind", temp_min: temp_min, temp_max: temp_max, dew_min: dew_min, dew_max: dew_max, hum_min: hum_min, hum_max: hum_max, pressure_min: pressure_min, pressure_max: pressure_max, name: name, wind: "", color: "#6495ED", weather_one_speed: weather_one['wind_speed'], weather_two_speed: weather_two['wind_speed'], weather_one_dir: weather_one['wind_dir'], weather_two_dir: weather_two['wind_dir'] } %>
      <% end %>
      <%= render partial: "game/new/weather_blank", locals: { color: "#DC143C" } %>

      <% (1..3).each do |one_sec| %>
        <%
          slogan = "#{one_sec}-#{one_sec + 1} hour"
          weather_one = weathers[one_sec - 1]
          weather_two = weathers[one_sec]

          temp_min = weather_one['temp_num']
          temp_max = weather_two['temp_num']
          if temp_min > temp_max
            temp_min = weather_two['temp_num']
            temp_max = weather_one['temp_num']
          end
          temp_diff = ((9 + temp_min - temp_max)/2).to_i
          temp_min = (temp_min - temp_diff).round(1)
          temp_max = (temp_max + temp_diff).round(1)

          dew_min = weather_one['dew_num']
          dew_max = weather_two['dew_num']
          if dew_min > dew_max
            dew_min = weather_two['dew_num']
            dew_max = weather_one['dew_num']
          end
          dew_diff = ((5 + dew_min - dew_max)/2).to_i
          dew_min = (dew_min - dew_diff).round(1)
          dew_max = (dew_max + dew_diff).round(1)

          pressure_min = (weather_one['pressure_num'] * 100).round
          pressure_max = (weather_two['pressure_num'] * 100).round
          if pressure_min > pressure_max
            pressure_min = (weather_two['pressure_num'] * 100).round
            pressure_max = (weather_one['pressure_num'] * 100).round
          end
          pressure_diff = ((8 + pressure_min - pressure_max)/2).to_i
          pressure_min = pressure_min - pressure_diff
          pressure_max = pressure_max + pressure_diff
        %>
      
        <% if one_sec == 1 %>
          <% 
            if weathers[0]['humid_num'] > weathers[3]['humid_num']
              hum_min = (weathers[0]['humid_num'] + 4).round
              hum_max = (weathers[0]['humid_num'] + 9).round
            else
              hum_min = (weathers[0]['humid_num'] - 9).round
              hum_max = (weathers[0]['humid_num'] - 4).round
            end
          %>
          <%= render partial: "game/new/prev_weather_value", locals: { caption: "Minus 5", temp_min: temp_min, temp_max: temp_max, dew_min: dew_min, dew_max: dew_max, hum_min: hum_min, hum_max: hum_max, pressure_min: (pressure_min/100.0).round(2), pressure_max: (pressure_max/100.0).round(2), name: name, wind: "", color: "gray", weather_one_speed: weather_one['wind_speed'], weather_two_speed: weather_two['wind_speed'], weather_one_dir: weather_one['wind_dir'], weather_two_dir: weather_two['wind_dir'] } %>
        <% end %>

        <% if one_sec == 3 %>
          <% 
            if weathers[0]['humid_num'] < weathers[3]['humid_num']
              hum_min = (weathers[3]['humid_num'] + 4).round
              hum_max = (weathers[3]['humid_num'] + 9).round
            else
              hum_min = (weathers[3]['humid_num'] - 9).round
              hum_max = (weathers[3]['humid_num'] - 4).round
            end
          %>
          <%= render partial: "game/new/prev_weather_value", locals: { caption: "Plus 5", temp_min: temp_min, temp_max: temp_max, dew_min: dew_min, dew_max: dew_max, hum_min: hum_min, hum_max: hum_max, pressure_min: (pressure_min/100.0).round(2), pressure_max: (pressure_max/100.0).round(2), name: name, wind: "", color: "gray", weather_one_speed: weather_one['wind_speed'], weather_two_speed: weather_two['wind_speed'], weather_one_dir: weather_one['wind_dir'], weather_two_dir: weather_two['wind_dir'] } %>
        <% end %>

        <%
          hum_min = weather_one['humid_num']
          hum_max = weather_two['humid_num']
          if hum_min > hum_max
            hum_min = weather_two['humid_num']
            hum_max = weather_one['humid_num']
          end
        %>
          <%= render partial: "game/new/prev_weather_value", locals: { caption: slogan, temp_min: temp_min, temp_max: temp_max, dew_min: dew_min, dew_max: dew_max, hum_min: hum_min, hum_max: hum_max, pressure_min: (pressure_min/100.0).round(2), pressure_max: (pressure_max/100.0).round(2), name: name, wind: "", color: "", weather_one_speed: weather_one['wind_speed'], weather_two_speed: weather_two['wind_speed'], weather_one_dir: weather_one['wind_dir'], weather_two_dir: weather_two['wind_dir'] } %>

          <%= render partial: "game/new/weather_blank", locals: { color: "#6495ED" } %>

        <%
          (hum_min..hum_max).each do |hum_each|
        %>
          <%= render partial: "game/new/prev_weather_value", locals: { caption: slogan, temp_min: temp_min, temp_max: temp_max, dew_min: dew_min, dew_max: dew_max, hum_min: hum_each, hum_max: hum_each, pressure_min: (pressure_min/100.0).round(2), pressure_max: (pressure_max/100.0).round(2), name: name, wind: "", color: "", weather_one_speed: weather_one['wind_speed'], weather_two_speed: weather_two['wind_speed'], weather_one_dir: weather_one['wind_dir'], weather_two_dir: weather_two['wind_dir'] } %>
        <% end %>

        <%= render partial: "game/new/weather_blank", locals: { color: "#DC143C" } %>
        <%= render partial: "game/new/weather_blank", locals: { color: "#6495ED" } %>
        <%= render partial: "game/new/weather_blank", locals: { color: "#DC143C" } %>
      <% end %>
      <%= render partial: "game/new/weather_blank", locals: { color: "sandybrown" } %>
    <% end %>
  </tbody>
</table>