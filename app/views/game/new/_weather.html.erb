<table class="table-bordered weather">
  <caption><%= caption %></caption>
  <thead>
  	<tr bgcolor="gray">
  	  <th width="50">Time</th>
  	  <th width="80">Temperature</th>
      <th width="50">Dew</th>
      <th width="60">Humidity</th>
      <th width="60">Pressure</th>
  	  <th width="60">Wind</th>
      <th width="10" class="blue"></th>
      <th width="50">Total Average 1</th>
      <th width="50">Total Average 2</th>
      <th width="50">Total Hits Average</th>
      <th width="50">Home Runs Average</th>
      <th width="50">Total Count</th>
      <th width="10" class="blue"></th>
      <th width="50">+/-1</th>
      <th width="50">Total Count +/-1</th>
      <th width="50">Total Lines Average</th>
      <th width="10" class="blue"></th>
      <th width="50">Home Team Total 1</th>
      <th width="50">Home Team Total 2</th>
      <th width="50">Total Hits in Park Average</th>
      <th width="50">Total HR's in this park</th>
      <th width="50">Home Total Count</th>
      <th width="10" class="blue"></th>
      <th width="50">Home +/- 1</th>
      <th width="50">Home Total Count +/- 1</th>
      <th width="50">Total Lines Average</th>
      <th width="50" style="background: red;">Time</th>
      <th width="50">Home Team Total 1</th>
      <th width="50">Home Team Total 2</th>
      <th width="50">Total Hits not in Park Average</th>
      <th width="50">Total HR's not in this park</th>
      <th width="50">Home Total Count</th>
      <th width="10" class="blue"></th>
      <th width="50">Home +/- 1</th>
      <th width="50">Home Total Count +/- 1</th>
      <th width="50">Total Lines Average</th>
  	</tr>
  </thead>
  <tbody>
    <% if weathers[3].temp_num != 0.0 %>
      <tr bgcolor="#DC143C">
        <td></td>
        <td colspan="5"><%= caption %></td>
        <td class="blue"></td>
        <td style="background: yellow;"></td>
        <td style="background: yellow;"></td>
        <td colspan="5" style="background: yellow;">All Stadiums</td>
        <td style="background: yellow;"></td>
        <td style="background: yellow;"></td>
        <td class="blue"></td>
        <td style="background: sandybrown;"></td>
        <td style="background: sandybrown;"></td>
        <td colspan="5" style="background: sandybrown;">Only <%= stadium %></td>
        <td style="background: sandybrown;"></td>
        <td style="background: sandybrown;"></td>
        <td></td>
        <td style="background: yellow;"></td>
        <td style="background: yellow;"></td>
        <td colspan="5" style="background: yellow;">All Stadiums except <%= stadium %></td>
        <td style="background: yellow;"></td>
        <td style="background: yellow;"></td>
      </tr>

      <% weathers.each do |weather| %>
        <% result = true_data(weather.temp_num - 5, weather.temp_num + 5, weather.dew_num-2, weather.dew_num+2, weather.humid_num-3, weather.humid_num+3, weather.pressure_num-0.04, weather.pressure_num+0.04, name) %>
      	<tr>
      		<td class="lightgray"><%= weather_time(weather.game.game_date, weather.hour) %></td>
          <td><%= weather.temp %></td>
          <td><%= weather.dp %></td>
          <td><%= weather.hum %></td>
          <td><%= weather.pressure %></td>
          <td><%= weather.wind %></td>
          <td class="blue"></td>
          <td><%= result[:total_avg_1] %></td>
          <td><%= result[:total_avg_2] %></td>
          <td><%= result[:total_hits_avg] %></td>
          <td><%= result[:home_runs_avg] %></td>
          <td><%= result[:total_count] %></td>
          <td class="blue"></td>
          <td><%= result[:lower_one] %></td>
          <td><%= result[:lower_one_count] %></td>
          <td style="background: gray; color: sandybrown;"><%= result[:total_lines_avg] %></td>
          <td class="blue"></td>
          <td style="background: sandybrown;"><%= result[:home_total_runs1_avg] %></td>
          <td style="background: sandybrown;"><%= result[:home_total_runs2_avg] %></td>
          <td style="background: sandybrown;"><%= result[:total_hits_park_avg] %></td>
          <td style="background: sandybrown;"><%= result[:total_hr_park] %></td>
          <td style="background: sandybrown;"><%= result[:home_count] %></td>
          <td class="blue"></td>
          <td style="background: sandybrown;"><%= result[:home_one] %></td>
          <td style="background: sandybrown;"><%= result[:home_one_count] %></td>
          <td style="background: gray; color: sandybrown;"><%= result[:total_lines_park_avg] %></td>
          <td class="lightgray"><%= weather_time(weather.game.game_date, weather.hour) %></td>
          <td><%= result[:home_total_runs1_avg_dup] %></td>
          <td><%= result[:home_total_runs2_avg_dup] %></td>
          <td><%= result[:total_hits_park_avg_dup] %></td>
          <td><%= result[:total_hr_park_dup] %></td>
          <td><%= result[:home_count_dup] %></td>
          <td class="blue"></td>
          <td><%= result[:home_one_dup] %></td>
          <td><%= result[:home_one_count_dup] %></td>
          <td><%= result[:total_lines_park_avg_dup] %></td>
      	</tr>
      <% end %>

      <%= render partial: "game/new/weather_blank", locals: { color: "#DC143C" } %>

      <% weathers.each_with_index do |weather, index| %>
        <%= render partial: "game/new/weather_value", locals: { caption: "#{index + 1} hour", temp_min: weather.temp_num - 4, temp_max: weather.temp_num + 4, dew_min: weather.dew_num-2, dew_max: weather.dew_num+2, hum_min: weather.humid_num-3, hum_max: weather.humid_num+3, pressure_min: (weather.pressure_num-0.04).round(2), pressure_max: (weather.pressure_num+0.04).round(2), name: name, wind: weather.wind, color: "" } %>
      <% end %>
      <% (1..3).each do |one_sec| %>
        <%
          weather_one = weathers[one_sec - 1]
          weather_two = weathers[one_sec]

          temp_min = weather_one.temp_num
          temp_max = weather_two.temp_num
          if temp_min > temp_max
            temp_min = weather_two.temp_num
            temp_max = weather_one.temp_num
          end
          temp_diff = ((16 + temp_min - temp_max)/2).to_i
          temp_min = temp_min - temp_diff
          temp_max = temp_max + temp_diff

          dew_min = weather_one.dew_num
          dew_max = weather_two.dew_num
          if dew_min > dew_max
            dew_min = weather_two.dew_num
            dew_max = weather_one.dew_num
          end
          dew_diff = ((7 + dew_min - dew_max)/2).to_i
          dew_min = dew_min - dew_diff
          dew_max = dew_max + dew_diff

          hum_min = weather_one.humid_num
          hum_max = weather_two.humid_num
          if hum_min > hum_max
            hum_min = weather_two.humid_num
            hum_max = weather_one.humid_num
          end
          if (hum_max - hum_min) < 9
            hum_diff = ((8 + hum_min - hum_max)/2).to_i
            hum_min = hum_min - hum_diff
            hum_max = hum_max + hum_diff
          end

          pressure_min = (weather_one.pressure_num * 100).round
          pressure_max = (weather_two.pressure_num * 100).round
          if pressure_min > pressure_max
            pressure_min = (weather_two.pressure_num * 100).round
            pressure_max = (weather_one.pressure_num * 100).round
          end
          pressure_diff = ((8 + pressure_min - pressure_max)/2).to_i
          pressure_min = ((pressure_min - pressure_diff)/100.0).round(2)
          pressure_max = ((pressure_max + pressure_diff)/100.0).round(2)

          wind_speed_min = weather_one.wind_speed.to_f
          wind_speed_max = weather_two.wind_speed.to_f
          if wind_speed_min > wind_speed_max
            wind_speed_min = weather_two.wind_speed.to_f
            wind_speed_max = weather_one.wind_speed.to_f
          end
          wind_speed_diff = ((11 + wind_speed_min - wind_speed_max)/2).to_i
          wind_speed_min = wind_speed_min - wind_speed_diff
          wind_speed_max = wind_speed_max + wind_speed_diff
        %>
          <% result = true_wind(temp_min, temp_max, dew_min, dew_max, hum_min, hum_max, pressure_min, pressure_max, wind_min, wind_max, weather_one.wind_dir, weather_two.wind_dir, name) %>
          <tr bgcolor="#6495ED">
              <td class="green">With wind</td>
              <td><%= "#{temp_min}-#{temp_max}" %></td>
              <td><%= "#{dew_min.round}-#{dew_max.round}" %><br><%= "#{(dew_min+1).round}-#{(dew_max-1).round}" %></td>
              <td><%= "#{hum_min}-#{hum_max}" %></td>
              <td><%= "#{(pressure_min*100).round%100}-#{(pressure_max*100).round%100}" %></td>
              <td><%= "#{wind_min}-#{wind_max}" %> , <%= weather_one.wind_dir == weather_two.wind_dir ? weather_one.wind_dir : "#{weather_one.wind_dir}, #{weather_two.wind_dir}" %></td>
              <td class="blue"></td>
              <td><%= result[:total_avg_1] %></td>
              <td><%= result[:total_avg_2] %></td>
              <td><%= result[:total_hits_avg] %></td>
              <td><%= result[:home_runs_avg] %></td>
              <td><%= result[:total_count] %></td>
              <td class="blue"></td>
              <td><%= result[:lower_one] %></td>
              <td><%= result[:lower_one_count] %></td>
              <td style="background: gray; color: sandybrown;"><%= result[:total_lines_avg] %></td>
              <td class="blue"></td>
              <td><%= result[:home_total_runs1_avg] %></td>
              <td><%= result[:home_total_runs2_avg] %></td>
              <td><%= result[:total_hits_park_avg] %></td>
              <td><%= result[:total_hr_park] %></td>
              <td><%= result[:home_count] %></td>
              <td class="blue"></td>
              <td><%= result[:home_one] %></td>
              <td><%= result[:home_one_count] %></td>
              <td><%= result[:total_lines_park_avg] %></td>
              <td class="lightgray"><%= "#{one_sec} hour" %></td>
              <td><%= result[:home_total_runs1_avg_dup] %></td>
              <td><%= result[:home_total_runs2_avg_dup] %></td>
              <td><%= result[:total_hits_park_avg_dup] %></td>
              <td><%= result[:total_hr_park_dup] %></td>
              <td><%= result[:home_count_dup] %></td>
              <td class="blue"></td>
              <td><%= result[:home_one_dup] %></td>
              <td><%= result[:home_one_count_dup] %></td>
              <td><%= result[:total_lines_park_avg_dup] %></td>
          </tr>
      <% end %>
      <% (1..3).each do |one_sec| %>
        <%
          slogan = "#{one_sec}-#{one_sec + 1} hour"
          weather_one = weathers[one_sec - 1]
          weather_two = weathers[one_sec]

          temp_min = weather_one.temp_num
          temp_max = weather_two.temp_num
          if temp_min > temp_max
            temp_min = weather_two.temp_num
            temp_max = weather_one.temp_num
          end
          temp_diff = ((9 + temp_min - temp_max)/2).to_i
          temp_min = temp_min - temp_diff
          temp_max = temp_max + temp_diff

          dew_min = weather_one.dew_num
          dew_max = weather_two.dew_num
          if dew_min > dew_max
            dew_min = weather_two.dew_num
            dew_max = weather_one.dew_num
          end
          dew_diff = ((5 + dew_min - dew_max)/2).to_i
          dew_min = dew_min - dew_diff
          dew_max = dew_max + dew_diff

          pressure_min = (weather_one.pressure_num * 100).round
          pressure_max = (weather_two.pressure_num * 100).round
          if pressure_min > pressure_max
            pressure_min = (weather_two.pressure_num * 100).round
            pressure_max = (weather_one.pressure_num * 100).round
          end
          pressure_diff = ((8 + pressure_min - pressure_max)/2).to_i
          pressure_min = pressure_min - pressure_diff
          pressure_max = pressure_max + pressure_diff
        %>

        <%= render partial: "game/new/weather_blank", locals: { color: "#DC143C" } %>
        <%= render partial: "game/new/weather_blank", locals: { color: "#6495ED" } %>
        <%= render partial: "game/new/weather_blank", locals: { color: "#DC143C" } %>
      
        <% if one_sec == 1 %>
          <% 
            if weathers[0].humid_num > weathers[3].humid_num
              hum_min = weathers[0].humid_num + 1
              hum_max = weathers[0].humid_num + 6
            else
              hum_min = weathers[0].humid_num - 6
              hum_max = weathers[0].humid_num - 1
            end
          %>
          <%= render partial: "game/new/weather_value", locals: { caption: "Before", temp_min: temp_min, temp_max: temp_max, dew_min: dew_min, dew_max: dew_max, hum_min: hum_min, hum_max: hum_max, pressure_min: (pressure_min/100.0).round(2), pressure_max: (pressure_max/100.0).round(2), name: name, wind: "", color: "gray" } %>
        <% end %>


        <% if one_sec == 3 %>
          <% 
            if weathers[0].humid_num < weathers[3].humid_num
              hum_min = weathers[3].humid_num + 1
              hum_max = weathers[3].humid_num + 6
            else
              hum_min = weathers[3].humid_num - 6
              hum_max = weathers[3].humid_num - 1
            end
          %>
          <%= render partial: "game/new/weather_value", locals: { caption: "After", temp_min: temp_min, temp_max: temp_max, dew_min: dew_min, dew_max: dew_max, hum_min: hum_min, hum_max: hum_max, pressure_min: (pressure_min/100.0).round(2), pressure_max: (pressure_max/100.0).round(2), name: name, wind: "", color: "gray" } %>
        <% end %>

        <%
          hum_min = weather_one.humid_num
          hum_max = weather_two.humid_num
          if hum_min > hum_max
            hum_min = weather_two.humid_num
            hum_max = weather_one.humid_num
          end
        %>
          <%= render partial: "game/new/weather_value", locals: { caption: slogan, temp_min: temp_min, temp_max: temp_max, dew_min: dew_min, dew_max: dew_max, hum_min: hum_min, hum_max: hum_max, pressure_min: (pressure_min/100.0).round(2), pressure_max: (pressure_max/100.0).round(2), name: name, wind: "", color: "" } %>

          <%= render partial: "game/new/weather_blank", locals: { color: "#6495ED" } %>

        <%
          (hum_min..hum_max).each do |hum_each|
        %>
          <%= render partial: "game/new/weather_value", locals: { caption: slogan, temp_min: temp_min, temp_max: temp_max, dew_min: dew_min, dew_max: dew_max, hum_min: hum_each, hum_max: hum_each, pressure_min: (pressure_min/100.0).round(2), pressure_max: (pressure_max/100.0).round(2), name: name, wind: "", color: "" } %>
        <% end %>
      <% end %>
      <%= render partial: "game/new/weather_blank", locals: { color: "sandybrown" } %>
    <% end %>
  </tbody>
</table>